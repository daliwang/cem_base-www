<!DOCTYPE html>
<title>CLM Inter-version Comparison</title>
<html>
	<style>

.link {
  fill: none;
  stroke: #666;
  stroke-width: 1.5px;
}

#disappeared {
  fill: #21B6A8;
}

#new {
  fill: #21B6A8;
}

.link.new {
  stroke: #21B6A8;
}

.link.disappeared {
  stroke: blue;
  stroke-dasharray: 0,2 1;

}


circle {
  fill: yellow;
  stroke: #333;
  stroke-width: 1.5px;
}


text {
  font: 15px sans-serif;
  pointer-events: none;
  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
}

h1{
	font: 30px Arial;
}

h2{
	font: 20px Arial;
}

h3{
	font: 15px Times New Roman;
}


.alignleft {
	float: left;
	color:white;
	font: 13px Arial;
}
.alignright {
	float: right;
	color:white;
	font: 13px Arial;
}


.graph
{
	border :1px solid black;
}


.legend
{
	border :1px solid black;
}


</style>
<body>

<div class="whole" style="width:1200px">

<div class="header" style="background-color:#003333;height:150px">
<h1 style="margin-bottom:0;color:white;text-align:center;">A Web-based Visual Analytic System for Understanding the CLM Structure</h1>
<h2 style="margin-bottom:0;color:white;text-align:center;">CLM <span style="color: blue;">Inter-version Comparison</span></h2>
<h3 style="margin-bottom:0;color:white;text-align:center;">Drag the node to move the graph. Remove to freeze.Scroll to Zoom in/out.</h3>

<a href="CLM_Overview.html" class="alignleft">
	Switch to CLM Structure Overview
</a>         


<a href="CanopyFluxes.html" class="alignright">
	Switch to CLM CanopyFluxes submodel
</a>  



</div>

<div class="legend" style="background-color:white;width:200px;height:1000px;float:left;">

<script src="lib/d3.min.js"></script>
<script>
		
		var width = 200,
    		height = 1000;
		
		var svg1 = d3.select("div.legend").
							append("svg").
							attr("width",width).
							attr("height",height);
		
		
		//Adding the legend
		var text=svg1.append("text");
		var textLabels=text
			.attr("x", 5)
			.attr("y", 30)
			.text("Legend")
			.style("font-family", "Times New Roman")
			.style("font-size", "20px")
			.style("font-weight", "bold")
			.style("fill", "black");
							

         
         var circle_index=[0,1,2,3];
         var circle_x=[15,15,15,15];
         var circle_y=[60,90,120,140];
         var circle_r=[10,10,6,6];
         var circle_color=["#3366CC","yellow","red","green"];
           		
         var circles= svg1.selectAll("circle").data(circle_index).enter().append("circle");
          
          
         circles.attr("cx",function(d) {return circle_x[d];})
          		.attr("cy",function(d) {return circle_y[d];})
          		.attr("r",function(d) {return circle_r[d];})
          		.style("fill",function(d) {return circle_color[d];});
          	
          	
         
         var line_index=[0,1];
         var line_x1=[10,10];
         var line_x2=[150,150];
         var line_y1=[180,220];
         var line_y2=[180,220];
         
         var lines= svg1.selectAll("line").data(line_index).enter().append("line");
         
         
         lines.attr("x1",function(d) {return line_x1[d];})
         	.attr("x2",function(d) {return line_x2[d];})
         	.attr("y1",function(d) {return line_y1[d];})
         	.attr("y2",function(d) {return line_y2[d];})
         	.style("stroke",function(d)
         	{
         		if(d==0) {return "#21B6A8";}
         		else {return "blue";}
         	})
         	.style("stroke-dasharray",function(d){
         		if(d==0) {return "none";}
         		else {return "0,2 1";}
         	})
         	.style("stroke-width","1.5px");
         
        

         
         var text_index=[0,1,2,3,4,5,6];
         var text_x=[-1,15,15,15,15,15,15];
         var text_y=[-1,55,90,120,140,175,215];
         var text_r=[-1,10,6,6,6,0,0];
         var text_name=["legend","New Function Calls","Modified Function Calls","New Variables","Modified Variables","New Links","Disappeared Links"];
         var texts= svg1.selectAll("text").data(text_index).enter().append("text");
          
         texts
         	.attr("x", function(d) {return text_x[d]+20;})
			.attr("y", function(d) {return text_y[d]+text_r[d];})
			.text(function(d) {return text_name[d];})
			.style("font-family", "Times New Roman")
			.style("font-size", "13px")
			.style("fill", "black");
	
	


</script>

</div>

<div class="graph" style="background-color:white;width:996px;height:1000px;float:left;">

	<script src="lib/d3.min.js"></script>
<script>


// http://blog.thomsonreuters.com/index.php/mobile-patent-suits-graphic-of-the-day/

var links=[];
var nodes={};


d3.json("Comparison.json",function(error,d)
{	
	
	var width = 996,
    height = 1000;
    
    var fill=d3.scale.category20();


	var svg = d3.select("div.graph")
			.append("svg")
			.attr("width",width)
			.attr("height",height)
			.attr("pointer-events", "all")
			.append("g")
			.call(d3.behavior.zoom().on("zoom", redraw))
			.append("g");
	
	 svg.append('svg:rect')
    .attr('width', width)
    .attr('height', height)
    .attr('fill', 'white');

	function redraw() {
  console.log("here", d3.event.translate, d3.event.scale);
  svg.attr("transform",
      "translate(" + d3.event.translate + ")"
      + " scale(" + d3.event.scale + ")");
}
	
	
	
	links=d.links;
		
		
		// Compute the distinct nodes from the links.
		d.links.forEach(function(link) {
		link.source = nodes[link.source] || (nodes[link.source] = {name: link.source, group: link.s_group,type: link.s_type});
      	link.target = nodes[link.target] || (nodes[link.target] = {name: link.target, group: link.t_group,type: link.t_type});
		});
		

//});

var force = d3.layout.force()
    .nodes(d3.values(nodes))
    .links(links)
    .size([width, height])
    .linkDistance(20)
    .charge(-300)
    .on("tick", tick)
    .start();


// Per-type markers, as they don't inherit styles.
svg.append("defs").selectAll("marker")
    .data(["disappeared","new"])
  .enter().append("marker")
    .attr("id", function(d) { return d; })
    .attr("viewBox", "0 -5 10 10")
    .attr("refX", 15)
    .attr("refY", -1.5)
    .attr("markerWidth", 6)
    .attr("markerHeight", 6)
    .attr("orient", "auto")
  .append("path")
    .attr("d", "M0,-5L10,0L0,5");

var path = svg.append("g").selectAll("path")
    .data(force.links())
  .enter().append("path")
    .attr("class", function(d) { return "link " + d.type; })
    .attr("marker-end", function(d) { return "url(#" + d.type + ")"; });

var circle = svg.append("g").selectAll("circle")
    .data(force.nodes())
    .enter().append("circle")
    .attr("r",
    
    	function(d)
    	{
    		if(d.group=="1") {return 10;}
    		else {return 6;}
    	}
    )
    .style("fill",
    
    	function(d)
    	{
    		if(d.group=='1')
    		{
    				switch(d.type)
    			{
    				case "modified":
    					return "yellow";
    					break;
    				case "new":
    					return "#3366CC";
    					break;
    				case "disapeared":
    					return "black";
    					break;
    				case "unchanged":
    					return "yellow";
    					break;
    			}
    		}
    		
    		else
    		{
    				switch(d.type)
    			{
    				case "modified":
    					return "green";
    					break;
    				case "new":
    					return "red";
    					break;
    				case "disapeared":
    					return "blue";
    					break;
    				case "unchanged":
    					return "green";
    					break;
    			}
    		}
    		
    	}
 	)
    	.call(force.drag);

circle.append("title")
	.text(function(d) {return d.name;});


var text = svg.append("g").selectAll("text")
    .data(force.nodes())
  .enter().append("text")
    .attr("x", 8)
    .attr("y", ".31em")
	.text(
		
		function(d)
		{
			if (d.group=="1") {return d.name;}
			else {return "";}
		});

// Use elliptical arc path segments to doubly-encode directionality.
function tick() {
  path.attr("d", linkArc);
  circle.attr("transform", transform);
  text.attr("transform", transform);
}

function linkArc(d) {
  var dx = d.target.x - d.source.x,
      dy = d.target.y - d.source.y,
      //dr = Math.sqrt(dx * dx + dy * dy);
      dr=0;
  return "M" + d.source.x + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + d.target.x + "," + d.target.y;
}


function transform(d) {
  return "translate(" + d.x + "," + d.y + ")";
}


circle.on("click", function(d) {
    
    force.stop();
    //alert("name:  "+d.name);
});



});  //this is the end brace of the d3.json function



</script>
	
</div>


</div>

</body>
</html>