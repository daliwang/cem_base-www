<!DOCTYPE html>
<title>CanopyFluxes</title>
<html>
	<style>

.link {
  fill: none;
  stroke: #666;
  stroke-width: 1.5px;
}

#licensing {
  fill: #21B6A8;
}

.link.licensing {
  stroke: #21B6A8;
}

.link.resolved {
  stroke-dasharray: 0,2 1;
}

circle {
  fill: black;
  stroke: #333;
  stroke-width: 1.5px;
}

text {
  font: 15px sans-serif;
  pointer-events: none;
  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
}

h1{
	font: 30px Arial;
}

h2{
	font: 20px Arial;
}

h3{
	font: 15px Times New Roman;
}


.alignleft {
	float: left;
	color:white;
	font: 13px Arial;
}

.alignleft2 {
	float: left;
	color:black;
	font: 13px Arial;
}

.alignright {
	float: right;
	color:white;
	font:  13px Arial;
}


.graph
{
	border :1px solid black;
}


.legend
{
	border :1px solid black;
}


</style>
<body>

<div class="whole" style="width:1200px">

<div class="header" style="background-color:#003333;height:150px">
<h1 style="margin-bottom:0;color:white;text-align:center;">A Web-based Visual Analytic System for Understanding the CLM Structure</h1>
<h2 style="margin-bottom:0;color:white;text-align:center;">Example of the <span style="color: blue;">CanopyFluxes</span> submodel.</h2>
<h3 style="margin-bottom:0;color:white;text-align:center;">Drag the node to move the graph. Remove to freeze.Scroll to Zoom in/out.</h3>


<a href="CLM_Overview.html" class="alignleft">
	Switch to CLM Structure Overview
</a>         


<a href="CLM_Comparison.html" class="alignright">
	Switch to CLM Inter-version Comparison
</a>  



</div>

<div class="legend" style="background-color:white;width:200px;height:1000px;float:left;">

<a href="CLM_Group.pdf" class="alignleft2">
	View Group Information
</a>  


<script src="lib/d3.min.js"></script>
<script>
		
		var width = 200,
    		height = 1000;
		
		var svg1 = d3.select("div.legend").
							append("svg").
							attr("width",width).
							attr("height",height);
		
		/*
		var rectangle = svg1.append("rect")
		.attr("x", 0)
		.attr("y", 0)
		.attr("height", height)
		.attr("width", width)
		.attr("fill","none")
		.style("stroke", "black")
		.style("stroke-width","1.5px");
		*/
		
		
		
		//Adding the legend
		var text=svg1.append("text");
		var textLabels=text
			.attr("x", 5)
			.attr("y", 30)
			.text("Legend")
			.style("font-family", "Times New Roman")
			.style("font-size", "20px")
			.style("font-weight", "bold")
			.style("fill", "black");
							

         
         var circle_index=[0,1,2,3];
         var circle_x=[15,15,15,15];
         var circle_y=[60,90,110,130];
         var circle_r=[10,6,6,6];
         var circle_color=["yellow","green","#3366CC","red"];
           		
         var circles= svg1.selectAll("circle").data(circle_index).enter().append("circle");
          
          
         circles.attr("cx",function(d) {return circle_x[d];})
          	.attr("cy",function(d) {return circle_y[d];})
          	.attr("r",function(d) {return circle_r[d];})
          	.style("fill",function(d) {return circle_color[d];});
         
         
         
         var text_index=[0,1,2,3,4];
         var text_x=[-1,15,15,15,15];
         var text_y=[-1,55,90,110,130];
         var text_r=[-1,10,6,6,6];
         var text_name=["legend","Function Calls","Subroutine Explicit","Global","Subroutine Explicit & Global"];
         var texts= svg1.selectAll("text").data(text_index).enter().append("text");
          
         texts
         	.attr("x", function(d) {return text_x[d]+20;})
			.attr("y", function(d) {return text_y[d]+text_r[d];})
			.text(function(d) {return text_name[d];})
			.style("font-family", "Times New Roman")
			.style("font-size", "13px")
			.style("fill", "black");
	
	


</script>

</div>

<div class="graph" style="background-color:white;width:996px;height:1000px;float:left;">

	<script src="lib/d3.min.js"></script>
<script>


var links=[];
var nodes={};


d3.json("CanopyFluxes.json",function(error,d)
{
	var width = 996,
    height = 1000;
    
    var fill=d3.scale.category20();

	
	var svg = d3.select("div.graph")
			.append("svg")
			.attr("width",width)
			.attr("height",height)
			.attr("pointer-events", "all")
			.append("g")
			.call(d3.behavior.zoom().on("zoom", redraw))
			.append("g");
	
	 svg.append('svg:rect')
    .attr('width', width)
    .attr('height', height)
    .attr('fill', 'white');

	function redraw() {
  console.log("here", d3.event.translate, d3.event.scale);
  svg.attr("transform",
      "translate(" + d3.event.translate + ")"
      + " scale(" + d3.event.scale + ")");
}
	
	
	
	links=d.links;
		
		
		// Compute the distinct nodes from the links.
		d.links.forEach(function(link) {
		link.source = nodes[link.source] || (nodes[link.source] = {name: link.source, group: link.s_group});
      	link.target = nodes[link.target] || (nodes[link.target] = {name: link.target, group: link.t_group});
		});
		

//});


var force = d3.layout.force()
    .nodes(d3.values(nodes))
    .links(links)
    .size([width, height])
    .linkDistance(20)
    .charge(-300)
    .on("tick", tick)
    .start();

/*
var svg = d3.select("div.graph").append("svg");


var rectangle = svg.append("rect")
		.attr("x", 0)
		.attr("y", 0)
		.attr("width", width)
		.attr("height", height)
		.attr("fill","none")
		.style("stroke", "black")
		.style("stroke-width","1.5px");
  
  

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);
*/

// Per-type markers, as they don't inherit styles.
svg.append("defs").selectAll("marker")
    .data(["suit", "licensing", "resolved"])
  .enter().append("marker")
    .attr("id", function(d) { return d; })
    .attr("viewBox", "0 -5 10 10")
    .attr("refX", 15)
    .attr("refY", -1.5)
    .attr("markerWidth", 6)
    .attr("markerHeight", 6)
    .attr("orient", "auto")
  .append("path")
    .attr("d", "M0,-5L10,0L0,5");


var path = svg.append("g").selectAll("path")
    .data(force.links())
  .enter().append("path")
    .attr("class", function(d) { return "link " + d.type; })
    .attr("marker-end", function(d) { return "url(#" + d.type + ")"; });


var circle = svg.append("g").selectAll("circle")
    .data(force.nodes())
    .enter().append("circle")
    .attr("r",
    
    	function(d)
    	{
    		if(d.group=="1") {return 10;}
    		else {return 6;}
    	}
    )
    .style("fill",
    
    	function(d)
    	{
    		switch(d.group)
    		{
    			case "1":
    				return "yellow";
    				break;
    			case "2":
    				return "green";
    				break;
    			case "2":
    				return "green";
    				break;
    			case "4":
    				return "#3366CC";
    				break;
    			case "5":
    				return "#3366CC";
    				break;
    			case "6":
    				return "#3366CC";
    				break;
    			case "7":
    				return "#3366CC";
    				break;
    			case "8":
    				return "green";
    				break;
    			case "9":
    				return "red";
    			case "10":
    				return "red";
    				break;
    			case "11":
    				return "red";
    				break;
    			case "17":
    				return "#3366CC";
    				break;
    			case "18":
    				return "#3366CC";
    			case "19":
    				return "#3366CC";
    			case "22":
    				return "#3366CC";
    				break;
    		}
    	}
   )
    .call(force.drag);

circle.append("title")
	.text(function(d) {return "name:  "+d.name+"  group:  "+d.group;});


var text = svg.append("g").selectAll("text")
    .data(force.nodes())
  .enter().append("text")
    .attr("x", 8)
    .attr("y", ".31em")
	.text(
		
		function(d)
		{
			if (d.group=="1") {return d.name;}
			else {return "";}
		});




// Use elliptical arc path segments to doubly-encode directionality.

function tick() {
  path.attr("d", linkArc);
  circle.attr("transform", transform);
  text.attr("transform", transform);
}

function linkArc(d) {
  var dx = d.target.x - d.source.x,
      dy = d.target.y - d.source.y,
      //dr = Math.sqrt(dx * dx + dy * dy);
      dr = 0;
  return "M" + d.source.x + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + d.target.x + "," + d.target.y;
}



function transform(d) {
  return "translate(" + d.x + "," + d.y + ")";
}





circle.on("click", function(d) {
    //alert(d.name);
    
    force.stop();  //freeze the graph
});



});  //this is the end brace of the d3.json function



</script>
	
</div>


</div>

</body>
</html>